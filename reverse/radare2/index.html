<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>radare2 - frozenkp's Blog</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "radare2", url: "#_top", children: [
              {title: "Links", url: "#links" },
              {title: "Install", url: "#install" },
              {title: "Start", url: "#start" },
              {title: "Analyze", url: "#analyze" },
              {title: "Seek", url: "#seek" },
              {title: "Comment", url: "#comment" },
              {title: "Print", url: "#print" },
              {title: "Project", url: "#project" },
              {title: "Quit", url: "#quit" },
              {title: "Visual Mode", url: "#visual-mode" },
              {title: "Evaluable vars", url: "#evaluable-vars" },
              {title: "Notes", url: "#notes" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../go/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../go/" class="btn btn-xs btn-link">
        Go
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../pwn/format_string/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../pwn/format_string/" class="btn btn-xs btn-link">
        Format String
      </a>
    </div>
    
  </div>

    

    <h1 id="radare2">radare2</h1>
<p>Radare2 是一個可以在 linux 用的靜態分析工具</p>
<h2 id="links">Links</h2>
<p><a href="https://github.com/radare/radare2">Github</a></p>
<p><a href="https://www.gitbook.com/book/radare/radare2book">Radare2 book</a></p>
<h2 id="install">Install</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> ~
git clone https://github.com/radare/radare2.git
<span class="nb">cd</span> radare2
sys/install.sh
</code></pre></div>
<h2 id="start">Start</h2>
<p>使用時就直接打 r2 binary 就可以進入 r2 的介面了</p>
<div class="highlight"><pre><span></span><code>r2 <span class="o">{</span>binary<span class="o">}</span>
</code></pre></div>
<p>一開始看到類似 shell 的畫面是 normal mode，可以輸入 <code>?</code> 來看可以使用的指令</p>
<div class="highlight"><pre><span></span><code>[XD] % r2 ./test.sym
 -- Use &#39;e&#39; and &#39;t&#39; in Visual mode to edit configuration and track flags.
[0x00400500]&gt; ?
Usage: [.][times][cmd][~grep][@[@iter]addr!size][|&gt;pipe] ; ...
Append &#39;?&#39; to any char command to get detailed help
Prefix with number to repeat command N times (f.ex: 3x)
|%var =valueAlias for &#39;env&#39; command
| *[?] off[=[0x]value]    Pointer read/write data/values (see ?v, wx, wv)
| (macro arg0 arg1)       Manage scripting macros
| .[?] [-|(m)|f|!sh|cmd]  Define macro or load r2, cparse or rlang file
| =[?] [cmd]              Send/Listen for Remote Commands (rap://, http://, &lt;fd&gt;)
| &lt;[...]                  Push escaped string into the RCons.readChar buffer
| /[?]                    Search for bytes, regexps, patterns, ..
| ![?] [cmd]              Run given command as in system(3)
| #[?] !lang [..]         Hashbang to run an rlang script
| a[?]                    Analysis commands
| b[?]                    Display or change the block size
| c[?] [arg]              Compare block with given data
| C[?]                    Code metadata (comments, format, hints, ..)
| d[?]                    Debugger commands
| e[?] [a[=b]]            List/get/set config evaluable vars
| f[?] [name][sz][at]     Add flag at current address
| g[?] [arg]              Generate shellcodes with r_egg
| i[?] [file]             Get info about opened file from r_bin
...
</code></pre></div>
<p>也可以再進一步用 <code>?</code> 看某個指令的用法</p>
<div class="highlight"><pre><span></span><code>[0x00400500]&gt; p?
|Usage: p[=68abcdDfiImrstuxz] [arg|len] [@addr]
| p-[?][jh] [mode]               bar|json|histogram blocks (mode: e?search.in)
| p=[?][bep] [blks] [len] [blk]  show entropy/printable chars/chars bars
| p2 [len]                       8x8 2bpp-tiles
| p3 [file]                      print stereogram (3D)
| p6[de] [len]                   base64 decode/encode
| p8[?][j] [len]                 8bit hexpair list of bytes
| pa[edD] [arg]                  pa:assemble  pa[dD]:disasm or pae: esil from hexpairs
| pA[n_ops]                      show n_ops address and type
| p[b|B|xb] [len] ([skip])       bindump N bits skipping M
| pb[?] [n]                      bitstream of N bits
| pB[?] [n]                      bitstream of N bytes
...
</code></pre></div>
<h2 id="analyze">Analyze</h2>
<h3 id="aa">aa</h3>
<p>分析 binary</p>
<blockquote>
<p>只會看 global name</p>
</blockquote>
<h3 id="aaa">aaa</h3>
<p>深度分析 binary</p>
<blockquote>
<p>function 底下使用到的 functoin 也會分析</p>
</blockquote>
<h3 id="afl">afl</h3>
<p>列出分析過的 function</p>
<p>必須先使用 <code>aa</code> 或是 <code>aaa</code> 以後，用 <code>afl</code> 才會有結果</p>
<h3 id="afn">afn</h3>
<p>更改 function 名稱</p>
<div class="highlight"><pre><span></span><code>afn {new_function_name} {old_function_name}
</code></pre></div>
<h3 id="afvn">afvn</h3>
<p>更改區域變數的名稱</p>
<div class="highlight"><pre><span></span><code>afvn {old_var_name} {new_var_name}
</code></pre></div>
<h2 id="seek">Seek</h2>
<h3 id="s">s</h3>
<p>移動到某個 address 或 function</p>
<div class="highlight"><pre><span></span><code>s {address}
s {function_name}
</code></pre></div>
<h2 id="comment">Comment</h2>
<h3 id="cc">CC</h3>
<p>在某處增加註解</p>
<blockquote>
<p>註解中不能包含 @，可以用 \n 來換行</p>
</blockquote>
<div class="highlight"><pre><span></span><code>CC {comment} @ {address}
</code></pre></div>
<h3 id="cc-">CC-</h3>
<p>刪除某處的註解</p>
<div class="highlight"><pre><span></span><code>CC- @ {address}
</code></pre></div>
<h2 id="print">Print</h2>
<h3 id="pd">pd</h3>
<p>印出從當前位置開始的 n 行指令</p>
<div class="highlight"><pre><span></span><code>pd n        # print n lines
pd 3        # print 3 lines
</code></pre></div>
<h3 id="pdc">pdc</h3>
<p>印出從當前 functoin 的 C-like pseudo code</p>
<blockquote>
<p>一定要在 function 的開頭才能用</p>
</blockquote>
<div class="highlight"><pre><span></span><code>pdc
</code></pre></div>
<h2 id="project">Project</h2>
<p>radare2 的 project 管理，可以在標記完 symbol 以後儲存在 project ，下次就直接開啟同一個 project 即可</p>
<div class="highlight"><pre><span></span><code>[0x00400618]&gt; P?
|Usage: P[?osi] [file]Project management
| Pc [file]    show project script to console
| Pd [file]    delete project
| Pi [file]    show project information
| Pl           list all projects
| Pn[j]        show project notes (Pnj for json)
| Pn [base64]  set notes text
| Pn -         edit notes with cfg.editor
| Po [file]    open project
| Ps [file]    save project
| PS [file]    save script file
| P- [file]    delete project (alias for Pd)
| NOTE:        See &#39;e??prj.&#39;
| NOTE:        project are stored in ~/.config/radare2/projects
</code></pre></div>
<h3 id="ps">Ps</h3>
<p>儲存當前專案</p>
<blockquote>
<p>有專案以後，在關閉時會詢問是否儲存</p>
</blockquote>
<div class="highlight"><pre><span></span><code>Ps {project_name}
</code></pre></div>
<h3 id="po">Po</h3>
<p>開啟某專案</p>
<div class="highlight"><pre><span></span><code>Po {project_name}
</code></pre></div>
<h3 id="ps_1">PS</h3>
<p>儲存 script</p>
<p>將當前所有的操作 (主要是 symbol 上的) 儲存成 script</p>
<blockquote>
<p>在開啟時用 <code>r2 -i {script} {binary}</code> 就把 symbol 都標回來了，不過會打不開 Visual Mode (原因不明)</p>
</blockquote>
<div class="highlight"><pre><span></span><code>PS {script_name}
</code></pre></div>
<h2 id="quit">Quit</h2>
<h3 id="q">q</h3>
<p>退出 r2 ，或者是退出某個模式</p>
<div class="highlight"><pre><span></span><code>q
</code></pre></div>
<h2 id="visual-mode">Visual Mode</h2>
<p>visual mode 可以看到 binary 的圖形</p>
<h3 id="_1">進入</h3>
<p>打一次 <code>V</code> 可以看到 binary 的 hexdump，再輸入一次 <code>V</code>  可以看到圖形</p>
<div class="highlight"><pre><span></span><code>V
</code></pre></div>
<h3 id="_2">退出</h3>
<p>退到上一層</p>
<div class="highlight"><pre><span></span><code>q
</code></pre></div>
<h3 id="_3">圖形模式格式切換</h3>
<p>可以切換看不同的顯示模式</p>
<div class="highlight"><pre><span></span><code>p
</code></pre></div>
<h3 id="normal-mode">輸入 normal mode 指令</h3>
<p>先打 <code>:</code> 以後可以看到一個類似 normal mode shell 的介面，輸入完指令多按一次 enter 就可以退回 Visual Mode</p>
<div class="highlight"><pre><span></span><code>:               # 進入 normal mode shell
&lt;enter&gt;         # 退回 Visual Mode
</code></pre></div>
<h3 id="define-function">define function</h3>
<p>輸入 df 就會自動定義 function 了</p>
<h3 id="patch">patch</h3>
<p>先用 <code>s</code> 移動到要 patch 的位置，接著輸入 <code>A</code> 可以看到當前的指令</p>
<p>此時鍵入要改的組合語言即可</p>
<blockquote>
<p>開啟時要用 r2 -w {file} 才能寫入</p>
</blockquote>
<p><img alt="" src="https://i.imgur.com/IUX1TxV.png" /></p>
<h2 id="evaluable-vars">Evaluable vars</h2>
<p>一些環境設定</p>
<h3 id="jump-table">開啟 jump table</h3>
<p>分析 switch 的時候，開啟 jump table 可以連 switch options 的內容都分析</p>
<blockquote>
<p>開啟以後，如果切換到 Visual Mode 會看到從 libc_start_main 開始的整張圖，要跑很久 (原因不明)</p>
</blockquote>
<div class="highlight"><pre><span></span><code>e anal.jmptbl = true
</code></pre></div>
<h2 id="notes">Notes</h2>
<ul>
<li><a href="https://blog.techorganic.com/2016/03/08/radare-2-in-0x1e-minutes/">r2 analyzes stripped binary</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../go/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../go/" class="btn btn-xs btn-link">
        Go
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../pwn/format_string/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../pwn/format_string/" class="btn btn-xs btn-link">
        Format String
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/frozenkp/frozenkp.github.io/edit/master/docs/reverse/radare2.md">Edit on frozenkp/frozenkp</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>